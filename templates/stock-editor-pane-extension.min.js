(function(){var Spinner=function(props){props=props||{};var spinner=this.spinner=document.createElement("div");if(props.id){spinner.id=props.id}spinner.style.display="none";spinner.style.position="absolute";spinner.style.zIndex=1051;spinner.style.top="50%";spinner.style.left="50%";spinner.style.transform="translateY(-50%) translateX(-50%)";spinner.style.textAlign="center";spinner.innerHTML='<div class="spinner-icon"><img src="'+Spinner.SPINNER_IMAGE+'" /></div>';document.body.appendChild(spinner)};Spinner.prototype.show=function(){this.spinner.style.display=""};Spinner.prototype.hide=function(){this.spinner.style.display="none"};Spinner.SPINNER_IMAGE="https://<% VAR_HOST %>/images/spinner.gif";var FullOverlay=function(props){props=props||{};var userAgent=window.navigator.userAgent.toLowerCase();var overlay=this.overlay=document.createElement("div");if(props.id){overlay.id=props.id}overlay.style.display="none";overlay.style.position="fixed";overlay.style.width="100%";overlay.style.height="100%";overlay.style.top=0;overlay.style.left=0;try{overlay.style.backgroundColor="rgba(255, 255, 255, 0.8)"}catch(err){if(userAgent.indexOf("msie")!=-1||userAgent.indexOf("trident")!=-1){overlay.style.backgroundColor="rgb(255, 255, 255)";overlay.style.cssText+=';-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(opacity=80)"'}}document.body.style.position="relative";document.body.appendChild(overlay)};FullOverlay.prototype.show=function(){this.overlay.style.display=""};FullOverlay.prototype.hide=function(){this.overlay.style.display="none"};var InventoryAdjustmentPanel=function(props){props=props||{};var div=document.createElement("div");if(!props.targetElement)return;if(props.id){div.id=props.id}div.style.display="flex";div.style.flexDirection="column";div.style.border="1px solid rgb(0, 0, 0)";div.style.padding="5px";div.style.width="148px";div.innerHTML=""+'<span style="position:relative;top:-10px;background-color: rgb(255, 255, 255);text-align: center;width: 60%;">在庫数量調整</span>'+'<div style="display: flex">'+"  <table><tr>"+'    <td><input type="button" value="訂正" style="width: 100%;margin-right: 5px;" /></td>'+'    <td><input type="text" value="0" style="width: 100%;" /></td>'+"  </tr></table>"+"</div>"+'<div id="'+knotty.consolePanel+'" style="display:none; color: red;">結果を表示する。</div>';props.targetElement.appendChild(div);document.querySelector("#"+div.id+' input[type="text"]').onkeyup=props.onKeyup||function(){};document.querySelector("#"+div.id+' input[type="button"]').onclick=props.onClick||function(){}};InventoryAdjustmentPanel.ID_JAN="dtilcol3";var knotty=function(){if(!knotty.isValid())return;this.overlay=new FullOverlay({id:"loading-mask"});this.spinner=new Spinner({id:"loading-bar-spinner"});knotty.appendScript("https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.map");new InventoryAdjustmentPanel({id:knotty.componentName,targetElement:document.querySelector("#dtildiv_1"),onKeyup:function(e){document.getElementById(knotty.consolePanel).style.display="none";document.querySelector("#"+knotty.componentName+' input[type="button"]').removeAttribute("disabled");if(this.value<0){document.querySelector("#"+knotty.componentName+' input[type="button"]').setAttribute("disabled","disabled")}document.querySelector("#"+knotty.componentName+' input[type="button"]').value=this.value>=0?"訂正":"×"},onClick:function(e){knottyInstance.begin.call(knottyInstance)}})};knotty.consolePanel="consolePanel";knotty.componentName="InventoryAdjustmentPanel";knotty.isValid=function(){if(document.getElementById("title")&&document.getElementById("title").innerHTML!=="商品詳細"){alert("商品詳細を開いて下さい。");return false}if(!document.getElementById(InventoryAdjustmentPanel.ID_JAN)){alert("JANが見つかりません。");return false}if(document.getElementById(knotty.componentName)){return false}return true};knotty.appendScript=function(src){s=document.createElement("script");s.setAttribute("language","javascript");s.setAttribute("type","text/javascript");s.setAttribute("src",src);s.setAttribute("charset","utf-8");document.body.appendChild(s)};knotty.jsonp=function(jan,qty){if(qty===0)return;var query=[["callback","callbackForJsonp"],["qty",qty],["jan",jan],["store","<% VAR_STORE_CODE %>"],["time",Date.now()]].map(function(e){return e.join("=")}).join("&");knotty.appendScript("https://<% VAR_HOST %>/jsonp/v1/inventories?"+query)};knotty.prototype.begin=function(){document.getElementById(knotty.consolePanel).style.display="none";this.overlay.show();this.spinner.show();var actual=Number(document.querySelector("#dtilcol14 span").innerHTML),expected=Number(document.querySelector("#"+knotty.componentName+" input[type=text]").value),jan=document.querySelector("#"+InventoryAdjustmentPanel.ID_JAN+" span").innerHTML;knotty.jsonp(jan,expected-actual)};knotty.prototype.end=function(){this.overlay.hide();this.spinner.hide()};var knottyInstance=new knotty;window.callbackForJsonp=callbackForJsonp;function callbackForJsonp(data){var message="在庫数量を変更しました。";knottyInstance.end.call(knottyInstance);if(data.isSuccess){document.querySelector("#dtilcol14 span").innerHTML=Number(document.querySelector("#"+knotty.componentName+" input[type=text]").value)}else{message="失敗！<br>"+(data.statusText||"")}document.getElementById(knotty.consolePanel).innerHTML=message;document.getElementById(knotty.consolePanel).style.display="block"}})();